<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aspora Activation Prototype (v5)</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Use Inter font */
        html {
            font-family: 'Inter', sans-serif;
        }

        /* Custom scrollbar for the mobile view */
        .mobile-screen::-webkit-scrollbar {
            width: 0;
            height: 0;
        }

        /* Basic screen transition */
        .screen {
            display: none; /* Hidden by default */
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
         @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        /* Sparkle animation for the âœ¨ emoji */
        @keyframes sparkle {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.4); opacity: 0.7; }
        }
        .sparkle {
            display: inline-block;
            animation: sparkle 1.5s infinite;
        }

        /* Camera overlay simulation */
        .camera-frame {
            position: relative;
            width: 100%;
            height: 200px;
            background-color: #333;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px dashed #666;
        }
        .camera-frame-inner {
            width: 90%;
            height: 160px;
            border: 2px solid rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            box-shadow: 0 0 0 2000px rgba(0,0,0,0.3);
        }

        /* Modal styles (FIXED) */
        .modal {
            display: none; /* Hidden by default */
            position: absolute; /* Changed from fixed to absolute */
            z-index: 50;
            inset: 0; /* Constrained to parent */
            background-color: rgba(0, 0, 0, 0.5); /* Dimmed background */
            align-items: center; /* Center vertically */
            justify-content: center; /* Center horizontally */
        }
        .modal-content {
            animation: fadeIn 0.2s ease-out;
        }
         /* Bottom Sheet Specific Styles (FIXED) */
        .bottom-sheet {
             justify-content: flex-end; /* Align to bottom */
             align-items: stretch; /* Stretch content width */
        }
        .bottom-sheet .modal-content {
            width: 100%; /* Now 100% of parent (mobile frame) */
            max-width: 100%; /* Ensure it spans mobile width */
            border-radius: 1.5rem 1.5rem 0 0; /* Rounded top corners */
            animation: slideUp 0.3s ease-out; /* Slide up animation */
            max-height: 90vh; /* Limit height */
            overflow-y: auto;
        }


        /* OTP Input */
        .otp-input {
            width: 3.5rem; /* Fixed width */
            height: 3.5rem; /* Fixed height */
            text-align: center;
            font-size: 1.5rem; /* Larger font */
            font-weight: 600;
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 0.5rem; /* rounded-lg */
            caret-color: #2563eb; /* blue-600 */
        }
        .otp-input:focus {
            outline: none;
            border-color: #2563eb; /* blue-600 */
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3); /* Ring effect */
        }

         /* Learn Section Slider */
        .course-slider {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            gap: 1rem; /* Space between cards */
            padding-bottom: 1rem; /* Space for scrollbar if needed */
            padding-left: 1.5rem; /* Match page padding */
            padding-right: 1.5rem; /* Match page padding */
            margin-left: -1.5rem; /* Counteract page padding for edge-to-edge look */
            margin-right: -1.5rem; /* Counteract page padding */
        }
        .course-slider::-webkit-scrollbar {
            height: 4px;
        }
        .course-slider::-webkit-scrollbar-thumb {
            background: #d1d5db; /* gray-300 */
            border-radius: 2px;
        }
        .course-card {
            flex: 0 0 75%; /* Each card takes up 75% of the container width */
            scroll-snap-align: start; /* Snap to the start of each card */
            min-height: 180px; /* Ensure cards have some height */
        }
        @media (min-width: 640px) { /* Adjust for larger screens if needed */
             .course-card {
                flex: 0 0 40%;
             }
        }
        /* Floating Rate Strip Style */
        #rate-strip {
             position: absolute; /* Changed from fixed to absolute within frame */
             top: 0;
             left: 0;
             right: 0;
             z-index: 40; /* Below modals */
             display: none; /* Hidden by default, shown by JS */
             animation: slideDownRate 0.5s ease-out;
             transform-origin: top;
        }
        @keyframes slideDownRate {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-800 flex items-center justify-center min-h-screen p-4">

    <!-- Mobile Phone Frame -->
    <div class="w-full max-w-sm bg-white rounded-3xl shadow-2xl overflow-hidden border-4 border-black relative"> <!-- Added relative positioning -->

        <!-- Floating Rate Strip (NEW) -->
         <div id="rate-strip" class="absolute top-0 left-0 right-0 bg-gray-900 text-white text-xs p-1 z-10 hidden whitespace-nowrap overflow-hidden">
             <!-- Static rates for demo -->
             <span class="font-semibold mx-2">AED/INR:</span> 22.50
             <span class="font-semibold mx-2">| USD/INR:</span> 83.05
             <span class="font-semibold mx-2">| AED/USD:</span> 0.27
         </div>

        <!-- Mobile Screen Content -->
        <div class="h-[750px] overflow-y-auto relative mobile-screen"> <!-- Added relative for strip context -->

            <!-- Screen: Welcome (Flow 1 - REDESIGNED CTAs) -->
            <div id="screen-welcome" class="screen p-6 flex flex-col h-full">
                <div class="flex-grow flex flex-col items-center justify-center text-center">
                    <!-- App Logo -->
                    <div class="w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center mb-6 shadow-lg">
                        <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0c-1.657 0-3-.895-3-2s1.343-2 3-2 3-.895 3-2-1.343-2-3-2m0 8c1.11 0 2.08.402 2.599-1M12 16v-1m0 1v8m0 0c-1.657 0-3-.895-3-2s1.343-2 3-2 3-.895 3-2-1.343-2-3-2m0 8c1.11 0 2.08.402 2.599-1M12 16v-1m0 1v8"></path></svg>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-900 mb-3">Welcome to Aspora</h1>
                    <p class="text-lg text-gray-600">
                        Send money from the <span class="font-semibold">UAE</span> to <span class="font-semibold">India</span>, faster and safer than ever.
                    </p>
                </div>
                <!-- Trust Pack -->
                <div class="text-center text-xs text-gray-500 mb-4">
                    <p>Regulated by the Central Bank of the UAE</p>
                </div>
                 <!-- REDESIGNED CTA Buttons -->
                <div class="pb-4 grid grid-cols-2 gap-4">
                    <button onclick="handleNewUserStart()" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-colors">
                        Sign Up
                    </button>
                    <button onclick="showScreen('screen-login')" class="w-full bg-gray-100 text-gray-800 font-bold py-3 px-5 rounded-lg border border-gray-300 hover:bg-gray-200 transition-colors">
                        Log In
                    </button>
                </div>
            </div>

            <!-- Screen: Login (Mobile + OTP - UPDATED Input) -->
            <div id="screen-login" class="screen p-6 flex flex-col h-full">
                <div class="flex-grow flex flex-col justify-center">
                    <!-- App Logo -->
                    <div class="w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center mb-6 shadow-lg mx-auto">
                        <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0c-1.657 0-3-.895-3-2s1.343-2 3-2 3-.895 3-2-1.343-2-3-2m0 8c1.11 0 2.08.402 2.599-1M12 16v-1m0 1v8m0 0c-1.657 0-3-.895-3-2s1.343-2 3-2 3-.895 3-2-1.343-2-3-2m0 8c1.11 0 2.08.402 2.599-1M12 16v-1m0 1v8"></path></svg>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-900 mb-6 text-center">Welcome Back</h1>

                    <div class="space-y-4">
                        <div>
                            <label for="mobile" class="block text-sm font-medium text-gray-700">Mobile Number</label>
                            <!-- UPDATED: ISD Code Button + Input Styling -->
                            <div class="flex mt-1">
                                <button id="isd-code-button" onclick="openIsdModal()" class="inline-flex items-center px-3 rounded-l-lg border border-r-0 border-gray-300 bg-gray-50 text-gray-700 text-sm hover:bg-gray-100 whitespace-nowrap">
                                    <span id="isd-flag">ðŸ‡¦ðŸ‡ª</span>&nbsp;<span id="isd-code">+971</span>&nbsp;â–¼
                                </button>
                                <input type="tel" id="mobile" value="50 123 4567" class="flex-grow w-full p-3 border border-gray-300 rounded-r-lg focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500" placeholder="5X XXX XXXX">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="pb-4">
                    <button onclick="handleLogin()" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-colors">
                        Continue
                    </button>
                    <p class="text-xs text-gray-500 text-center mt-4">
                        By continuing, you agree to our <a href="#" class="font-medium text-blue-600">Terms</a> and <a href="#" class="font-medium text-blue-600">Privacy Policy</a>.
                    </p>
                    <button onclick="showScreen('screen-welcome')" class="w-full text-center text-sm text-blue-600 font-medium py-2 mt-2">
                        Don't have an account? Sign Up
                    </button>
                </div>
            </div>

            <!-- Screen: OTP -->
            <div id="screen-otp" class="screen p-6 flex flex-col h-full">
                 <header class="mb-6 flex items-center">
                    <button onclick="showScreen('screen-login')" class="text-blue-600 p-1 -ml-1">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                </header>
                <div class="flex-grow flex flex-col justify-center">
                    <h1 class="text-2xl font-bold text-gray-900 mb-3 text-center">Enter 6-Digit Code</h1>
                    <p class="text-gray-600 text-center mb-8">We sent a code to <span id="otp-mobile-display" class="font-medium text-gray-900">+971 50 123 4567</span>.</p>

                    <div class="flex justify-center space-x-2" id="otp-inputs">
                        <input type="tel" maxlength="1" id="otp-1" class="otp-input" pattern="[0-9]" oninput="handleOtpInput(this, 'otp-2')" onkeydown="handleOtpBackspace(this, null)">
                        <input type="tel" maxlength="1" id="otp-2" class="otp-input" pattern="[0-9]" oninput="handleOtpInput(this, 'otp-3')" onkeydown="handleOtpBackspace(this, 'otp-1')">
                        <input type="tel" maxlength="1" id="otp-3" class="otp-input" pattern="[0-9]" oninput="handleOtpInput(this, 'otp-4')" onkeydown="handleOtpBackspace(this, 'otp-2')">
                        <input type="tel" maxlength="1" id="otp-4" class="otp-input" pattern="[0-9]" oninput="handleOtpInput(this, 'otp-5')" onkeydown="handleOtpBackspace(this, 'otp-3')">
                        <input type="tel" maxlength="1" id="otp-5" class="otp-input" pattern="[0-9]" oninput="handleOtpInput(this, 'otp-6')" onkeydown="handleOtpBackspace(this, 'otp-4')">
                        <input type="tel" maxlength="1" id="otp-6" class="otp-input" pattern="[0-9]" oninput="handleOtpInput(this, null)" onkeydown="handleOtpBackspace(this, 'otp-5')">
                    </div>

                    <p class="text-center text-sm text-gray-500 mt-6">Didn't receive a code? <button class="font-medium text-blue-600">Resend</button></p>
                </div>
                <div class="pb-4">
                    <button id="otp-verify-button" onclick="handleOtpSubmit()" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-colors disabled:opacity-50" disabled>
                        Verify
                    </button>
                </div>
            </div>


            <!-- Screen: Onboarding 1 -->
            <div id="screen-onboarding-1" class="screen p-6 flex flex-col h-full">
                 <div class="mb-6">
                    <div class="bg-gray-200 rounded-full h-2.5">
                        <div class="bg-blue-600 h-2.5 rounded-full" style="width: 33%"></div>
                    </div>
                    <p class="text-sm text-gray-500 text-right mt-1">Step 1 of 3</p>
                </div>
                <div class="flex-grow flex flex-col items-center justify-center text-center">
                    <svg class="w-32 h-32 text-blue-600 mb-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 8l3 5m0 0l3-5m-3 5v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3h15a3 3 0 01-3 3M9 11a3 3 0 01-3-3h15a3 3 0 01-3 3m-6 0a3 3 0 01-3-3h15a3 3 0 01-3 3M9 14a3 3 0 01-3-3h15a3 3 0 01-3 3M9 17a3 3 0 01-3-3h15a3 3 0 01-3 3M9 20a3 3 0 01-3-3h15a3 3 0 01-3 3H9z"></path></svg>
                    <h2 class="text-2xl font-bold text-gray-900 mb-3">Lightning-Fast Transfers</h2>
                    <p class="text-base text-gray-600">
                        Send money in minutes. Your family in India gets it when they need it.
                    </p>
                </div>
                <div class="pb-4">
                    <button onclick="showScreen('screen-onboarding-2')" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-colors">
                        Next
                    </button>
                </div>
            </div>

            <!-- Screen: Onboarding 2 -->
            <div id="screen-onboarding-2" class="screen p-6 flex flex-col h-full">
                <div class="mb-6">
                    <div class="bg-gray-200 rounded-full h-2.5">
                        <div class="bg-blue-600 h-2.5 rounded-full" style="width: 66%"></div>
                    </div>
                    <p class="text-sm text-gray-500 text-right mt-1">Step 2 of 3</p>
                </div>
                <div class="flex-grow flex flex-col items-center justify-center text-center">
                    <svg class="w-32 h-32 text-blue-600 mb-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0c-1.657 0-3-.895-3-2s1.343-2 3-2 3-.895 3-2-1.343-2-3-2m0 8c1.11 0 2.08.402 2.599-1M12 16v-1m0 1v8m0 0c-1.657 0-3-.895-3-2s1.343-2 3-2 3-.895 3-2-1.343-2-3-2m0 8c1.11 0 2.08.402 2.599-1M12 16v-1m0 1v8"></path></svg>
                    <h2 class="text-2xl font-bold text-gray-900 mb-3">Transparent Rates, No Surprises</h2>
                    <p class="text-base text-gray-600">
                        No hidden fees. What you see is what you get, with the best AED to INR rates.
                    </p>
                </div>
                <div class="pb-4">
                    <button onclick="goHome()" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-colors">
                        Next
                    </button>
                </div>
            </div>

            <!-- Screen: Home Checklist -->
            <div id="screen-home-checklist" class="screen p-6 flex flex-col h-full bg-gray-50">
                 <header class="mb-6">
                    <h1 class="text-3xl font-bold text-gray-900">Welcome, Ahmed</h1>
                    <p class="text-lg text-gray-600">Let's get you started.</p>
                </header>
                <p class="text-sm font-medium text-gray-700 mb-3">Your setup progress</p>
                <div class="space-y-3">
                    <!-- Step 1: Verify ID -->
                    <div id="checklist-kyc" class="bg-white p-4 rounded-lg shadow transition-all">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div id="checklist-kyc-icon" class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold">
                                    1
                                </div>
                                <div>
                                    <p id="checklist-kyc-title" class="font-semibold text-gray-900">Verify your identity</p>
                                    <p id="checklist-kyc-subtitle" class="text-sm text-gray-500">Required by UAE law</p>
                                </div>
                            </div>
                            <button id="checklist-kyc-button" onclick="showScreen('screen-kyc-intro')" class="bg-blue-600 text-white font-medium py-2 px-4 rounded-lg text-sm">
                                Start
                            </button>
                        </div>
                    </div>

                    <!-- Step 2: Fund Account -->
                    <div id="checklist-funding" class="bg-white p-4 rounded-lg shadow transition-all opacity-50">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div id="checklist-funding-icon" class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-gray-500 font-bold">
                                    2
                                </div>
                                <div>
                                    <p id="checklist-funding-title" class="font-semibold text-gray-700">Add funds to your account</p>
                                    <p id="checklist-funding-subtitle" class="text-sm text-gray-500">Add money to send</p>
                                </div>
                            </div>
                            <button id="checklist-funding-button" class="bg-gray-200 text-gray-500 font-medium py-2 px-4 rounded-lg text-sm" disabled>
                                Start
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 3: Starter Transfer -->
                    <div id="checklist-transfer" class="bg-white p-4 rounded-lg shadow transition-all opacity-50">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div id="checklist-transfer-icon" class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-gray-500 font-bold">
                                    3
                                </div>
                                <div>
                                    <p id="checklist-transfer-title" class="font-semibold text-gray-700">Make your first transfer</p>
                                    <p id="checklist-transfer-subtitle" class="text-sm text-gray-500">Enjoy zero fees on us!</p>
                                </div>
                            </div>
                            <button id="checklist-transfer-button" class="bg-gray-200 text-gray-500 font-medium py-2 px-4 rounded-lg text-sm" disabled>
                                Start
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Trust Pack -->
                <div class="mt-auto pt-6 text-center text-xs text-gray-500">
                    <p class="font-semibold mb-2">Trusted by our partners:</p>
                    <div class="flex justify-center items-center space-x-4 grayscale opacity-60">
                        <span class="font-bold text-lg">VISA</span>
                        <span class="font-bold text-lg">Mastercard</span>
                        <span class="font-bold text-lg">HDFC BANK</span>
                    </div>
                </div>
            </div>

            <!-- --- KYC FLOW --- -->
            <div id="screen-kyc-intro" class="screen p-6 flex flex-col h-full">
                <button onclick="goHome()" class="text-blue-600 font-medium mb-4 flex items-center">
                    <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    Back to Home
                </button>
                <div class="flex-grow flex flex-col items-center justify-center text-center">
                    <svg class="w-32 h-32 text-blue-600 mb-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M10.05 4.575a1.5 1.5 0 10-3.001.001M10.05 4.575a1.5 1.5 0 013.001.001M10.05 4.575v1.5a1.5 1.5 0 001.5 1.5h1.5a1.5 1.5 0 001.5-1.5v-1.5a1.5 1.5 0 00-1.5-1.5h-1.5a1.5 1.5 0 00-1.5 1.5zM3.75 6A1.5 1.5 0 015.25 4.5h9.5a1.5 1.5 0 011.5 1.5v15a1.5 1.5 0 01-1.5 1.5h-9.5A1.5 1.5 0 013.75 21v-15zM4.125 6.375c0-1.036.84-1.875 1.875-1.875h8.5c1.035 0 1.875.84 1.875 1.875v14.25c0 1.035-.84 1.875-1.875 1.875h-8.5c-1.036 0-1.875-.84-1.875-1.875V6.375z" />
                    </svg>
                    <h2 class="text-2xl font-bold text-gray-900 mb-3">Let's Get You Verified</h2>
                    <p class="text-base text-gray-600 mb-4">To protect your account, we need to verify your identity. This usually takes less than 2 minutes.</p>
                    <p class="text-sm text-gray-500">You will need your <span class="font-medium">Emirates ID</span> and to <span class="font-medium">take a selfie</span>.</p>
                </div>
                <div class="pb-4">
                    <button onclick="showScreen('screen-kyc-scan-front')" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-colors">
                        Start Verification
                    </button>
                </div>
            </div>
            <div id="screen-kyc-scan-front" class="screen p-6 flex flex-col h-full">
                <p class="text-sm text-gray-500 mb-2">Step 1 of 3</p>
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Scan Front of Emirates ID</h2>
                <p class="text-base text-gray-600 mb-6">
                    Place your ID inside the frame. We'll scan it automatically.
                </p>
                <div class="camera-frame mb-6">
                    <div class="camera-frame-inner"></div>
                </div>
                <p id="kyc-front-feedback" class="text-center text-blue-600 font-medium mb-4 h-6"></p>
                <div class="pb-4 mt-auto">
                    <button onclick="simulateKycScan('front')" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-colors">
                        Scan
                    </button>
                </div>
            </div>
            <div id="screen-kyc-scan-back" class="screen p-6 flex flex-col h-full">
                <p class="text-sm text-gray-500 mb-2">Step 2 of 3</p>
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Scan Back of Emirates ID</h2>
                <p class="text-base text-gray-600 mb-6">
                    Now, flip your ID over and place it in the frame.
                </p>
                <div class="camera-frame mb-6">
                    <div class="camera-frame-inner"></div>
                </div>
                <p id="kyc-back-feedback" class="text-center text-blue-600 font-medium mb-4 h-6"></p>
                <div class="pb-4 mt-auto">
                    <button onclick="simulateKycScan('back')" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-colors">
                        Scan
                    </button>
                </div>
            </div>
            <div id="screen-kyc-selfie" class="screen p-6 flex flex-col h-full">
                <p class="text-sm text-gray-500 mb-2">Step 3 of 3</p>
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Take a quick selfie</h2>
                <p class="text-base text-gray-600 mb-6">
                    Center your face in the oval. This helps us confirm you're really you.
                </p>
                <div class="w-64 h-80 bg-gray-300 rounded-full mx-auto mb-6 flex items-center justify-center border-4 border-dashed border-gray-400">
                    <svg class="w-32 h-32 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                </div>
                 <p id="kyc-selfie-feedback" class="text-center text-blue-600 font-medium mb-4 h-6"></p>
                <div class="pb-4 mt-auto">
                    <button onclick="simulateKycScan('selfie')" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-colors">
                        Take Photo
                    </button>
                </div>
            </div>
            <div id="screen-kyc-verifying" class="screen p-6 flex flex-col h-full items-center justify-center text-center">
                <div class="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-6"></div>
                <h2 class="text-2xl font-bold text-gray-900 mb-3">Verifying Your ID...</h2>
                <p class="text-base text-gray-600">
                    This will only take a moment.
                </p>
            </div>
            <div id="screen-kyc-verified" class="screen p-6 flex flex-col h-full items-center justify-center text-center">
                <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mb-6">
                    <svg class="w-16 h-16 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mb-3">Identity Verified!</h2>
                <p class="text-base text-gray-600 mb-8">
                    You're all set. Let's get your account funded.
                </p>
                <div class="pb-4 w-full">
                    <button onclick="completeKycStep()" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-colors">
                        Continue
                    </button>
                </div>
            </div>

            <!-- --- FUNDING FLOW --- -->
            <div id="screen-funding-picker" class="screen p-6 flex flex-col h-full bg-gray-50">
                <header class="mb-6 flex items-center">
                    <button onclick="goHome()" class="text-blue-600 p-1 -ml-1">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <h1 class="text-xl font-bold text-gray-900 ml-2">Add Funds</h1>
                </header>
                <p class="text-gray-600 mb-6">How would you like to add money?</p>
                <div class="space-y-4">
                    <button onclick="showScreen('screen-funding-success')" class="w-full text-left bg-black text-white p-4 rounded-lg shadow hover:bg-gray-800 transition-all">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3"><svg class="w-6 h-6" viewBox="0 0 38 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M29.531 16.7115C28.5303 17.778 27.2452 18.375 25.8617 18.375C24.4782 18.375 23.193 17.778 22.1923 16.7115C21.1681 15.6206 20.625 14.1804 20.625 12.671C20.625 11.1616 21.1681 9.7214 22.1923 8.63044C23.193 7.56396 24.4782 6.9668 25.8617 6.9668C26.5435 6.9668 27.2136 7.10648 27.8385 7.37762C28.4634 7.64876 29.0289 8.0461 29.507 8.54619C29.985 8.0461 30.5471 7.64876 31.172 7.37762C31.7968 7.10648 32.467 6.9668 33.1487 6.9668C34.5322 6.9668 35.8173 7.56396 36.818 8.63044C37.8422 9.7214 38.3853 11.1616 38.3853 12.671C38.3853 14.1804 37.8422 15.6206 36.818 16.7115C35.8173 17.778 34.5322 18.375 33.1487 18.375C31.7652 18.375 30.48 17.778 29.4793 16.7115L29.531 16.7115Z" fill="white"></path><path d="M25.8617 5.61328C26.7915 4.60803 27.4687 3.39327 27.8385 2.05957C26.9604 2.11536 26.1095 2.42848 25.352 2.97233C24.5945 3.51617 23.9531 4.27072 23.4751 5.16328C24.2326 5.48621 25.0485 5.61328 25.8617 5.61328Z" fill="white"></path></svg><span class="font-bold text-lg">Pay</span></div>
                            <div class="text-right"><p class="font-semibold text-green-400">Fastest</p><p class="text-sm text-gray-300">Fee: 0.00 AED</p></div>
                        </div>
                    </button>
                    <button onclick="showScreen('screen-add-card')" class="w-full text-left bg-white p-4 rounded-lg shadow hover:bg-gray-100 transition-all border">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3"><svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H4a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg><span class="font-semibold text-gray-900">Debit/Credit Card</span></div>
                            <div class="text-right"><p class="font-semibold text-gray-700">Instant</p><p class="text-sm text-gray-500">Fee: 2.50 AED</p></div>
                        </div>
                    </button>
                    <button onclick="showScreen('screen-bank-transfer')" class="w-full text-left bg-white p-4 rounded-lg shadow hover:bg-gray-100 transition-all border">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3"><svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5h.01"></path></svg><span class="font-semibold text-gray-900">Bank Transfer</span></div>
                            <div class="text-right"><p class="font-semibold text-gray-700">1-2 Hours</p><p class="text-sm text-gray-500">Fee: 0.00 AED</p></div>
                        </div>
                    </button>
                </div>
            </div>
            <div id="screen-add-card" class="screen p-6 flex flex-col h-full bg-gray-50">
                <header class="mb-6 flex items-center">
                    <button onclick="showScreen('screen-funding-picker')" class="text-blue-600 p-1 -ml-1"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                    <h1 class="text-xl font-bold text-gray-900 ml-2">Add Debit/Credit Card</h1>
                </header>
                <div class="space-y-4">
                    <div><label for="card-number" class="block text-sm font-medium text-gray-700">Card Number</label><input type="tel" id="card-number" class="w-full p-3 border border-gray-300 rounded-lg mt-1" placeholder="0000 0000 0000 0000"></div>
                    <div><label for="cardholder-name" class="block text-sm font-medium text-gray-700">Cardholder Name</label><input type="text" id="cardholder-name" class="w-full p-3 border border-gray-300 rounded-lg mt-1" placeholder="Ahmed"></div>
                    <div class="flex space-x-4">
                        <div class="flex-1"><label for="expiry-date" class="block text-sm font-medium text-gray-700">Expiry Date</label><input type="tel" id="expiry-date" class="w-full p-3 border border-gray-300 rounded-lg mt-1" placeholder="MM/YY"></div>
                        <div class="flex-1"><label for="cvc" class="block text-sm font-medium text-gray-700">CVC</label><input type="tel" id="cvc" class="w-full p-3 border border-gray-300 rounded-lg mt-1" placeholder="123"></div>
                    </div>
                </div>
                <div class="pb-4 mt-auto"><button onclick="showScreen('screen-funding-success')" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Add 1,500 AED</button></div>
            </div>
            <div id="screen-bank-transfer" class="screen p-6 flex flex-col h-full bg-gray-50">
                <header class="mb-6 flex items-center">
                    <button onclick="showScreen('screen-funding-picker')" class="text-blue-600 p-1 -ml-1"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                    <h1 class="text-xl font-bold text-gray-900 ml-2">Bank Transfer Details</h1>
                </header>
                <p class="text-gray-600 mb-6">Make a transfer to the details below from your UAE bank app. Please include your reference number.</p>
                <div class="bg-white p-4 rounded-lg shadow space-y-4">
                    <div><p class="text-sm text-gray-500">Amount to send</p><p class="font-semibold text-lg text-gray-900">1,500.00 AED</p></div>
                    <div><p class="text-sm text-gray-500">Reference Number</p><p class="font-semibold text-lg text-gray-900">ASPORA-12345</p></div>
                    <div><p class="text-sm text-gray-500">Bank Name</p><p class="font-semibold text-lg text-gray-900">First Abu Dhabi Bank (FAB)</p></div>
                    <div><p class="text-sm text-gray-500">Account Name</p><p class="font-semibold text-lg text-gray-900">Aspora Payments FZE</p></div>
                    <div><p class="text-sm text-gray-500">IBAN</p><p class="font-semibold text-lg text-gray-900">AE12 3456 7890 1234 5678 901</p></div>
                </div>
                <div class="pb-4 mt-auto"><button onclick="showScreen('screen-funding-success')" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-colors">I've Made the Transfer</button></div>
            </div>
            <div id="screen-funding-success" class="screen p-6 flex flex-col h-full items-center justify-center text-center">
                <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mb-6"><svg class="w-16 h-16 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div>
                <h2 class="text-2xl font-bold text-gray-900 mb-3">Funds Added!</h2>
                <p class="text-base text-gray-600 mb-8">You're ready to make your first transfer.</p>
                <div class="pb-4 w-full"><button onclick="completeFundingStep()" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Continue</button></div>
            </div>

            <!-- --- TRANSFER FLOW --- -->
            <div id="screen-transfer" class="screen p-6 flex flex-col h-full bg-gray-50">
                <header class="mb-6 flex items-center">
                    <button onclick="goHome()" class="text-blue-600 p-1 -ml-1"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                    <h1 id="transfer-title" class="text-xl font-bold text-gray-900 ml-2">Your Starter Transfer</h1>
                </header>
                <div id="transfer-starter-banner" class="bg-blue-600 text-white rounded-lg p-4 mb-6 shadow-lg flex items-center space-x-3">
                    <svg class="w-8 h-8 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 11.25v8.25a8.25 8.25 0 01-16.5 0v-8.25a8.25 8.25 0 0116.5 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z" /></svg>
                    <div><h3 class="font-bold">Welcome Gift: Zero Fees!</h3><p class="text-sm opacity-90">Your first transfer to India is on us.</p></div>
                </div>
                <div class="bg-white p-5 rounded-lg shadow-md">
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-1"><label for="send-amount" class="block text-sm font-medium text-gray-700">You send</label><button id="from-currency-button" onclick="openCurrencyModal('from')" class="text-sm font-semibold text-blue-600 flex items-center"><span id="from-currency-flag">ðŸ‡¦ðŸ‡ª</span>&nbsp;<span id="from-currency-code">AED</span><svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button></div>
                        <div class="relative"><input type="number" id="send-amount" value="5" oninput="calculateReceive()" class="w-full p-3 border border-gray-300 rounded-lg text-2xl font-bold"></div>
                    </div>
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-1"><label for="receive-amount" class="block text-sm font-medium text-gray-700">They receive</label><button id="to-currency-button" onclick="openCurrencyModal('to')" class="text-sm font-semibold text-blue-600 flex items-center"><span id="to-currency-flag">ðŸ‡®ðŸ‡³</span>&nbsp;<span id="to-currency-code">INR</span><svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button></div>
                        <div class="relative"><input type="text" id="receive-amount" class="w-full p-3 border border-gray-200 bg-gray-100 rounded-lg text-2xl font-bold text-gray-900" readonly></div>
                    </div>
                    <div class="text-sm text-gray-600 space-y-1">
                        <div class="flex justify-between"><span>Exchange Rate:</span><span id="exchange-rate-display" class="font-medium text-gray-900">1 AED = 22.50 INR</span></div>
                        <div class="flex justify-between"><span>Transfer Fee:</span><span id="fee-display" class="font-medium text-green-600">FREE (Gift)</span></div>
                    </div>
                    <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg text-center"><p id="rate-lock-text" class="font-semibold text-blue-700">Rate Locked for: <span id="rate-lock-timer">02:00</span></p></div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow-md my-6">
                    <p class="text-sm text-gray-500 mb-1">Sending to:</p>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3"><div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 font-bold">V</div><div><p class="font-semibold">Vijay Sharma</p><p class="text-sm text-gray-500">HDFC Bank ...1234</p></div></div>
                        <button class="text-blue-600 font-medium">Change</button>
                    </div>
                </div>
                <div class="pb-4 mt-auto"><button id="transfer-continue-button" onclick="showConfirmation()" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Continue to Send</button></div>
            </div>
            <div id="screen-confirmation" class="screen p-6 flex flex-col h-full bg-gray-50">
                <header class="mb-6 flex items-center">
                    <button onclick="loadTransferScreen()" class="text-blue-600 p-1 -ml-1"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                    <h1 class="text-xl font-bold text-gray-900 ml-2">Confirm Transfer</h1>
                </header>
                <p class="text-center text-gray-600 mb-2">You are sending</p>
                <p id="confirm-send-amount" class="text-center text-5xl font-bold text-gray-900 mb-6">5.00 AED</p>
                <div class="bg-white rounded-lg shadow-md divide-y divide-gray-200">
                    <div class="p-4"><p class="text-sm text-gray-500 mb-1">Recipient</p><p id="confirm-recipient-name" class="font-semibold text-gray-900">Vijay Sharma</p><p class="text-gray-600">HDFC Bank ...1234</p></div>
                    <div class="p-4"><p class="text-sm text-gray-500 mb-1">They will receive</p><p id="confirm-receive-amount" class="font-semibold text-gray-900 text-lg">112.50 INR</p></div>
                    <div class="p-4 space-y-2">
                        <div class="flex justify-between text-sm"><span class="text-gray-600">Exchange Rate</span><span id="confirm-exchange-rate" class="font-medium text-gray-900">1 AED = 22.50 INR</span></div>
                        <div class="flex justify-between text-sm"><span class="text-gray-600">Fee</span><span id="confirm-fee" class="font-medium text-green-600">FREE</span></div>
                        <div class="flex justify-between font-bold text-base"><span class="text-gray-900">Total to pay</span><span id="confirm-total" class="text-gray-900">5.00 AED</span></div>
                    </div>
                </div>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 my-6 flex items-center space-x-3">
                    <svg class="w-6 h-6 text-blue-600 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.623 0-1.413-.293-2.754-.802-4.014A11.959 11.959 0 0115 5.714" /></svg>
                    <p class="text-sm text-blue-700">Secured by Aspora. Regulated by the Central Bank of the UAE.</p>
                </div>
                <div class="pb-4 mt-auto"><button onclick="handleSuccess()" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Confirm & Send</button></div>
            </div>
            <div id="screen-success" class="screen p-6 flex flex-col h-full items-center justify-center text-center">
                <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mb-6"><svg class="w-16 h-16 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div>
                <h2 class="text-2xl font-bold text-gray-900 mb-3">Transfer Sent!</h2>
                <p id="success-message" class="text-base text-gray-600 mb-8">Your <span class="font-semibold">5.00 AED</span> is on its way to Vijay Sharma.</p>
                <div class="pb-4 w-full space-y-3">
                    <button onclick="showGeminiModal()" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" style="transform: scale(0.9);"><path fill-rule="evenodd" d="M10 2.5a.75.75 0 01.75.75V6h2.5a.75.75 0 010 1.5H10.75V10h2.5a.75.75 0 010 1.5H10.75V14h2.5a.75.75 0 010 1.5H10.75v2.75a.75.75 0 01-1.5 0V15.5H6.75a.75.75 0 010-1.5H9.25V11H6.75a.75.75 0 010-1.5H9.25V6H6.75a.75.75 0 010-1.5H9.25V3.25A.75.75 0 0110 2.5zM6 10a.75.75 0 01.75-.75h.01a.75.75 0 01.75.75v.01a.75.75 0 01-.75.75h-.01a.75.75 0 01-.75-.75v-.01zM13.25 10a.75.75 0 01.75-.75h.01a.75.75 0 01.75.75v.01a.75.75 0 01-.75.75h-.01a.75.75 0 01-.75-.75v-.01zM10 6a.75.75 0 01.75-.75h.01a.75.75 0 01.75.75v.01a.75.75 0 01-.75.75h-.01A.75.75 0 0110 6v-.01zM10 13.25a.75.75 0 01.75-.75h.01a.75.75 0 01.75.75v.01a.75.75 0 01-.75.75h-.01a.75.75 0 01-.75-.75v-.01z" clip-rule="evenodd"></path></svg><span class="sparkle">âœ¨</span><span>Notify Recipient</span></button>
                    <button onclick="goHome()" class="w-full text-gray-600 font-medium py-3 px-5 rounded-lg mt-2">Back to Home</button>
                </div>
            </div>

            <!-- --- FULL APP SCREENS --- -->

            <!-- Screen: App Home -->
            <div id="screen-app-home" class="screen flex-col h-full bg-gray-50 pt-6">
                <header class="px-6 pb-4">
                     <div class="flex items-center justify-between">
                        <button onclick="showScreen('screen-app-profile')" class="flex items-center space-x-2">
                            <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 font-bold">A</div>
                            <div><p class="text-sm text-gray-500">Welcome back,</p><p class="font-bold text-gray-900">Ahmed</p></div>
                        </button>
                        <button onclick="showScreen('screen-notifications')" class="relative text-gray-500 hover:text-gray-900">
                            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341A6.002 6.002 0 006 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>
                            <span class="absolute top-0 right-0 w-2.5 h-2.5 bg-red-500 border-2 border-white rounded-full"></span>
                        </button>
                    </div>
                </header>
                <div class="px-6 pt-2">
                    <p class="text-sm text-gray-500">Total Balance</p>
                    <p id="wallet-balance-display" class="text-4xl font-bold text-gray-900 mt-1">0.00 AED</p>
                    <div class="flex items-center space-x-3 mt-6">
                        <button onclick="loadTransferScreen()" class="flex-1 bg-blue-600 text-white font-medium py-3 px-4 rounded-lg flex flex-col items-center justify-center space-y-1 shadow-lg">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>
                            <span>Send</span>
                        </button>
                        <button onclick="showScreen('screen-funding-picker')" class="flex-1 bg-gray-100 text-gray-800 font-medium py-3 px-4 rounded-lg flex flex-col items-center justify-center space-y-1 border border-gray-200">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                            <span>Add Money</span>
                        </button>
                        <button onclick="showScreen('screen-request-money')" class="flex-1 bg-gray-100 text-gray-800 font-medium py-3 px-4 rounded-lg flex flex-col items-center justify-center space-y-1 border border-gray-200">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 17l-4 4m0 0l-4-4m4 4V3"></path></svg>
                            <span>Request</span>
                        </button>
                    </div>
                </div>
                <div class="px-6 mt-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">Your currencies</h3>
                    <div class="space-y-3">
                        <div class="bg-white p-4 rounded-lg shadow-md flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <span class="text-3xl">ðŸ‡¦ðŸ‡ª</span>
                                <div><p class="font-semibold text-gray-900">AED</p><p class="text-sm text-gray-500">UAE Dirham</p></div>
                            </div>
                            <span id="aed-balance-display" class="font-semibold text-lg">0.00</span>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-md flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <span class="text-3xl">ðŸ‡®ðŸ‡³</span>
                                <div><p class="font-semibold text-gray-900">INR</p><p class="text-sm text-gray-500">Indian Rupee</p></div>
                            </div>
                            <span id="inr-balance-display" class="font-semibold text-lg">0.00</span>
                        </div>
                    </div>
                 </div>
                <div class="px-6 mt-6 flex-grow overflow-y-auto pb-20">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">Recent Activity</h3>
                    <div id="transaction-list" class="space-y-3">
                        <p id="no-transactions" class="text-gray-500 text-sm">You haven't made any transactions yet.</p>
                    </div>
                </div>
                <nav class="absolute bottom-0 left-0 right-0 bg-white border-t border-gray-200 flex justify-around h-16 items-center">
                    <button class="text-center text-blue-600">
                        <svg class="w-6 h-6 mx-auto" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg>
                        <span class="text-xs font-medium">Home</span>
                    </button>
                    <button onclick="showScreen('screen-app-learn')" class="text-center text-gray-500 hover:text-blue-600">
                        <svg class="w-6 h-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                        <span class="text-xs font-medium">Learn</span>
                    </button>
                    <button onclick="showScreen('screen-app-profile')" class="text-center text-gray-500 hover:text-blue-600">
                        <svg class="w-6 h-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                        <span class="text-xs font-medium">Profile</span>
                    </button>
                </nav>
            </div>

             <!-- Screen: Request Money (NEW) -->
             <div id="screen-request-money" class="screen p-6 flex flex-col h-full bg-gray-50">
                <header class="mb-6 flex items-center">
                    <button onclick="goHome()" class="text-blue-600 p-1 -ml-1">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <h1 class="text-xl font-bold text-gray-900 ml-2">Request Money</h1>
                </header>
                <p class="text-gray-600 mb-6">Create a payment link to share with anyone.</p>
                <div class="space-y-4">
                     <div>
                        <label for="request-amount" class="block text-sm font-medium text-gray-700">Amount</label>
                        <div class="flex mt-1">
                             <input type="number" id="request-amount" class="flex-grow w-full p-3 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500" placeholder="0.00">
                             <button onclick="openCurrencyModal('request')" class="inline-flex items-center px-3 rounded-r-lg border border-l-0 border-gray-300 bg-gray-50 text-gray-700 text-sm hover:bg-gray-100 whitespace-nowrap">
                                <span id="request-currency-flag">ðŸ‡¦ðŸ‡ª</span>&nbsp;<span id="request-currency-code">AED</span>&nbsp;â–¼
                            </button>
                        </div>
                    </div>
                     <div>
                        <label for="request-note" class="block text-sm font-medium text-gray-700">Note (Optional)</label>
                        <input type="text" id="request-note" class="w-full p-3 border border-gray-300 rounded-lg mt-1" placeholder="e.g., For dinner last night">
                    </div>
                </div>
                <div class="pb-4 mt-auto">
                    <button onclick="alert('Generate Request Link clicked!')" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-colors">
                        Generate Request Link
                    </button>
                </div>
            </div>


            <!-- Screen: App Learn (UPDATED with Slider) -->
            <div id="screen-app-learn" class="screen flex-col h-full bg-gray-50">
                <header class="p-6">
                    <h1 class="text-3xl font-bold text-gray-900">Learn</h1>
                    <p class="text-lg text-gray-600">Get the most out of Aspora</p>
                </header>
                <div class="flex-grow space-y-6 overflow-y-auto">
                    <div class="pt-2">
                        <h2 class="text-xl font-semibold text-gray-900 mb-3 px-6">Courses</h2>
                        <div class="course-slider">
                            <div class="course-card bg-blue-600 text-white p-4 rounded-lg shadow-md flex flex-col justify-between">
                                <div><h3 class="font-bold text-lg mb-2">Understanding FX Rates</h3><p class="text-sm opacity-90 mb-4">Learn what affects the rate you get and how Aspora keeps it fair.</p></div>
                                <button onclick="showScreen('screen-learn-story-1')" class="text-sm bg-white text-blue-600 px-4 py-2 rounded-full font-semibold mt-2 self-start">Start Learning</button>
                            </div>
                            <div class="course-card bg-green-600 text-white p-4 rounded-lg shadow-md flex flex-col justify-between">
                                <div><h3 class="font-bold text-lg mb-2">Sending Your First Transfer</h3><p class="text-sm opacity-90 mb-4">A step-by-step guide to moving money quickly and easily.</p></div>
                                <button onclick="showScreen('screen-learn-story-2')" class="text-sm bg-white text-green-600 px-4 py-2 rounded-full font-semibold mt-2 self-start">Start Learning</button>
                            </div>
                            <div class="course-card bg-indigo-600 text-white p-4 rounded-lg shadow-md flex flex-col justify-between">
                                <div><h3 class="font-bold text-lg mb-2">Keeping Your Account Secure</h3><p class="text-sm opacity-90 mb-4">Tips on passwords, scams, and protecting your funds.</p></div>
                                <button onclick="showScreen('screen-learn-story-1')" class="text-sm bg-white text-indigo-600 px-4 py-2 rounded-full font-semibold mt-2 self-start">Start Learning</button>
                            </div>
                        </div>
                    </div>
                    <div class="px-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-3">Guides</h2>
                        <div class="bg-white p-4 rounded-lg shadow-md flex space-x-4 mb-3">
                            <div class="w-16 h-16 bg-green-100 rounded-lg flex items-center justify-center"><svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg></div>
                            <div><h3 class="font-semibold text-gray-900">How to Avoid Scams</h3><p class="text-sm text-gray-600">Stay safe when sending money online.</p><a href="#" class="text-sm text-blue-600 font-medium mt-1 inline-block">Read Guide</a></div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-md flex space-x-4">
                            <div class="w-16 h-16 bg-indigo-100 rounded-lg flex items-center justify-center"><svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.653-.08-1.285-.23-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.653.08-1.285.23-1.857m0 0a5.002 5.002 0 019.54 0M12 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div>
                            <div><h3 class="font-semibold text-gray-900">Inviting Friends</h3><p class="text-sm text-gray-600">Earn rewards when you refer a friend.</p><a href="#" class="text-sm text-blue-600 font-medium mt-1 inline-block">Read Guide</a></div>
                        </div>
                    </div>
                </div>
                <div class="h-20 flex-shrink-0"></div>
                <nav class="absolute bottom-0 left-0 right-0 bg-white border-t border-gray-200 flex justify-around h-16 items-center">
                    <button onclick="showScreen('screen-app-home')" class="text-center text-gray-500 hover:text-blue-600"><svg class="w-6 h-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 01-1 1h-2a1 1 0 01-1-1v-4z"></path></svg><span class="text-xs font-medium">Home</span></button>
                    <button class="text-center text-blue-600"><svg class="w-6 h-6 mx-auto" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a8 8 0 100 16 8 8 0 000-16zM9.049 4.027c.414-.415 1.082-.415 1.497 0l2.68 2.68c.415.414.415 1.082 0 1.497l-2.68 2.68c-.415.414-1.082.414-1.497 0l-2.68-2.68c-.415-.414-.415-1.082 0-1.497l2.68-2.68zM5 10.5A1.5 1.5 0 016.5 9h7A1.5 1.5 0 0115 10.5v1A1.5 1.5 0 0113.5 13h-7A1.5 1.5 0 015 11.5v-1z"></path></svg><span class="text-xs font-medium">Learn</span></button>
                    <button onclick="showScreen('screen-app-profile')" class="text-center text-gray-500 hover:text-blue-600"><svg class="w-6 h-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg><span class="text-xs font-medium">Profile</span></button>
                </nav>
            </div>

            <!-- Screen: Learn Story 1 (NEW) -->
            <div id="screen-learn-story-1" class="screen p-6 flex flex-col h-full bg-blue-600 text-white">
                 <header class="mb-6 flex items-center">
                    <button onclick="showScreen('screen-app-learn')" class="text-white p-1 -ml-1 opacity-80 hover:opacity-100"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                    <h1 class="text-xl font-bold ml-2">Understanding FX Rates</h1>
                </header>
                <div class="flex-grow flex flex-col items-center justify-center text-center">
                    <svg class="w-32 h-32 mb-8 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0c-1.657 0-3-.895-3-2s1.343-2 3-2 3-.895 3-2-1.343-2-3-2m0 8c1.11 0 2.08.402 2.599-1M12 16v-1m0 1v8m0 0c-1.657 0-3-.895-3-2s1.343-2 3-2 3-.895 3-2-1.343-2-3-2m0 8c1.11 0 2.08.402 2.599-1M12 16v-1m0 1v8"></path></svg>
                    <h2 class="text-2xl font-bold mb-3">Chapter 1: What is an FX Rate?</h2>
                    <p class="text-base opacity-90">It's simply the price of one currency in terms of another. Example: 1 AED might equal 22.50 INR.</p>
                </div>
                 <div class="pb-4 flex justify-between items-center">
                    <button onclick="showScreen('screen-app-learn')" class="text-white font-medium opacity-80 hover:opacity-100">Close</button>
                    <button class="bg-white text-blue-600 font-bold py-2 px-5 rounded-lg">Next</button>
                </div>
            </div>
             <!-- Screen: Learn Story 2 (NEW) -->
            <div id="screen-learn-story-2" class="screen p-6 flex flex-col h-full bg-green-600 text-white">
                 <header class="mb-6 flex items-center">
                    <button onclick="showScreen('screen-app-learn')" class="text-white p-1 -ml-1 opacity-80 hover:opacity-100"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                    <h1 class="text-xl font-bold ml-2">Sending Your First Transfer</h1>
                </header>
                 <div class="flex-grow flex flex-col items-center justify-center text-center">
                    <svg class="w-32 h-32 mb-8 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>
                    <h2 class="text-2xl font-bold mb-3">Step 1: Enter Amount</h2>
                    <p class="text-base opacity-90">Type how much you want to send, or how much you want them to receive. We calculate the rest!</p>
                </div>
                 <div class="pb-4 flex justify-between items-center">
                    <button onclick="showScreen('screen-app-learn')" class="text-white font-medium opacity-80 hover:opacity-100">Close</button>
                    <button class="bg-white text-green-600 font-bold py-2 px-5 rounded-lg">Next</button>
                </div>
            </div>

            <!-- Screen: App Profile -->
            <div id="screen-app-profile" class="screen flex-col h-full bg-gray-50">
                 <header class="p-6"> <h1 class="text-3xl font-bold text-gray-900">Profile</h1> </header>
                 <div class="flex-grow overflow-y-auto">
                    <div class="p-6 pt-0">
                        <div class="flex items-center space-x-4">
                            <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 font-bold text-3xl">A</div>
                            <div>
                                <p class="text-xl font-bold text-gray-900">Ahmed</p>
                                <p class="text-gray-600">ahmed@aspora.com</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white border-y border-gray-200 divide-y divide-gray-200">
                        <button onclick="showScreen('screen-edit-profile')" class="w-full text-left p-4 flex justify-between items-center hover:bg-gray-50">
                            <span class="font-medium text-gray-700">Edit Profile</span>
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                        <button onclick="showScreen('screen-bank-details')" class="w-full text-left p-4 flex justify-between items-center hover:bg-gray-50">
                            <span class="font-medium text-gray-700">Manage Bank Details</span>
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                        <button class="w-full text-left p-4 flex justify-between items-center hover:bg-gray-50">
                            <span class="font-medium text-gray-700">Security</span>
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                        <button onclick="showScreen('screen-help-support')" class="w-full text-left p-4 flex justify-between items-center hover:bg-gray-50">
                            <span class="font-medium text-gray-700">Help & Support</span>
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                    </div>
                     <div class="p-6">
                        <button onclick="handleLogout()" class="w-full text-left p-4 bg-white rounded-lg shadow-sm text-red-600 font-medium hover:bg-gray-50">
                            Log Out
                        </button>
                     </div>
                 </div>
                 <div class="h-20 flex-shrink-0"></div>
                 <nav class="absolute bottom-0 left-0 right-0 bg-white border-t border-gray-200 flex justify-around h-16 items-center">
                    <button onclick="showScreen('screen-app-home')" class="text-center text-gray-500 hover:text-blue-600"><svg class="w-6 h-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 01-1 1h-2a1 1 0 01-1-1v-4z"></path></svg><span class="text-xs font-medium">Home</span></button>
                    <button onclick="showScreen('screen-app-learn')" class="text-center text-gray-500 hover:text-blue-600"><svg class="w-6 h-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg><span class="text-xs font-medium">Learn</span></button>
                    <button class="text-center text-blue-600"><svg class="w-6 h-6 mx-auto" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zM12 12a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" /></svg><span class="text-xs font-medium">Profile</span></button>
                 </nav>
            </div>

            <!-- Screen: Edit Profile (UPDATED) -->
            <div id="screen-edit-profile" class="screen p-6 flex flex-col h-full bg-gray-50">
                <header class="mb-6 flex items-center">
                    <button onclick="showScreen('screen-app-profile')" class="text-blue-600 p-1 -ml-1"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                    <h1 class="text-xl font-bold text-gray-900 ml-2">Edit Profile</h1>
                </header>
                <div class="space-y-4">
                    <div><label for="edit-name" class="block text-sm font-medium text-gray-700">Full Name</label><input type="text" id="edit-name" value="Ahmed" class="w-full p-3 border border-gray-300 rounded-lg mt-1"></div>
                    <div><label for="edit-email" class="block text-sm font-medium text-gray-700">Email Address</label><input type="email" id="edit-email" value="ahmed@aspora.com" class="w-full p-3 border border-gray-300 rounded-lg mt-1"></div>
                     <div><label class="block text-sm font-medium text-gray-700">Date of Birth</label><input type="text" value="01 / Jan / 1990" class="w-full p-3 border border-gray-200 bg-gray-100 rounded-lg mt-1" readonly disabled></div>
                     <div><label class="block text-sm font-medium text-gray-700">Gender</label><input type="text" value="Male" class="w-full p-3 border border-gray-200 bg-gray-100 rounded-lg mt-1" readonly disabled></div>
                </div>
                <div class="pb-4 mt-auto">
                    <button onclick="showScreen('screen-app-profile')" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-colors">
                        Save Changes
                    </button>
                </div>
            </div>

            <!-- Screen: Bank Details -->
            <div id="screen-bank-details" class="screen p-6 flex flex-col h-full bg-gray-50">
                <header class="mb-6 flex items-center">
                    <button onclick="showScreen('screen-app-profile')" class="text-blue-600 p-1 -ml-1"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                    <h1 class="text-xl font-bold text-gray-900 ml-2">Bank Details</h1>
                </header>
                <p class="text-gray-600 mb-6">Manage your saved recipient bank accounts.</p>
                <div class="space-y-3">
                    <div class="bg-white p-4 rounded-lg shadow-md flex items-center justify-between">
                        <div class="flex items-center space-x-3"><div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 font-bold">V</div><div><p class="font-semibold text-gray-900">Vijay Sharma</p><p class="text-sm text-gray-500">HDFC Bank ...1234</p></div></div>
                        <button class="text-gray-500 hover:text-red-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>
                    </div>
                </div>
                <div class="pb-4 mt-auto"><button class="w-full bg-blue-100 text-blue-700 font-bold py-3 px-5 rounded-lg hover:bg-blue-200 transition-colors">Add New Account</button></div>
            </div>

             <!-- Screen: Help & Support (NEW) -->
            <div id="screen-help-support" class="screen p-6 flex flex-col h-full bg-gray-50">
                <header class="mb-6 flex items-center">
                    <button onclick="showScreen('screen-app-profile')" class="text-blue-600 p-1 -ml-1"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                    <h1 class="text-xl font-bold text-gray-900 ml-2">Help & Support</h1>
                </header>
                <div class="space-y-4">
                     <input type="text" placeholder="Search help articles..." class="w-full p-3 border border-gray-300 rounded-lg mb-4">
                     <h2 class="text-lg font-semibold text-gray-800">Frequently Asked Questions</h2>
                     <a href="#" class="block bg-white p-4 rounded-lg shadow-sm hover:bg-gray-50">How long do transfers take?</a>
                     <a href="#" class="block bg-white p-4 rounded-lg shadow-sm hover:bg-gray-50">What are the fees?</a>
                     <a href="#" class="block bg-white p-4 rounded-lg shadow-sm hover:bg-gray-50">How do I verify my identity?</a>
                     <a href="#" class="block bg-white p-4 rounded-lg shadow-sm hover:bg-gray-50">Is my money safe?</a>
                </div>
                <div class="pb-4 mt-auto">
                    <button onclick="showScreen('screen-chatbot')" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2">
                         <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg>
                         <span>Chat with Us</span>
                    </button>
                </div>
            </div>

             <!-- Screen: Chatbot (NEW) -->
             <div id="screen-chatbot" class="screen flex flex-col h-full bg-gray-100">
                <header class="p-4 bg-white border-b border-gray-200 flex items-center space-x-3 sticky top-0">
                    <button onclick="showScreen('screen-help-support')" class="text-blue-600 p-1 -ml-1"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                    <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold">A</div>
                    <div><h1 class="text-lg font-bold text-gray-900">Aspora Support</h1><p class="text-sm text-green-600">Online</p></div>
                </header>
                 <div class="flex-grow p-4 space-y-4 overflow-y-auto">
                     <div class="flex justify-start">
                         <div class="bg-white p-3 rounded-lg max-w-[75%] shadow-sm"><p class="text-sm text-gray-800">Hi Ahmed! How can I help you today? You can ask about transfer status, fees, or verification.</p><p class="text-xs text-gray-400 text-right mt-1">10:30 AM</p></div>
                     </div>
                     <div class="flex justify-end">
                         <div class="bg-blue-500 text-white p-3 rounded-lg max-w-[75%] shadow-sm"><p class="text-sm">What's the status of my transfer to Vijay?</p><p class="text-xs text-blue-100 text-right mt-1">10:31 AM</p></div>
                     </div>
                     <div class="flex justify-start">
                         <div class="bg-white p-3 rounded-lg max-w-[75%] shadow-sm"><p class="text-sm text-gray-800">Okay, let me check... Your transfer of 5.00 AED to Vijay Sharma was successfully completed about 15 minutes ago. ðŸŽ‰</p><p class="text-xs text-gray-400 text-right mt-1">10:31 AM</p></div>
                     </div>
                 </div>
                <footer class="p-4 bg-white border-t border-gray-200 flex items-center sticky bottom-0">
                    <input type="text" placeholder="Type your message..." class="flex-grow p-3 border border-gray-300 rounded-full focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 mr-2">
                    <button class="bg-blue-600 text-white p-3 rounded-full shadow-md hover:bg-blue-700"><svg class="w-5 h-5 transform rotate-90" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"></path></svg></button>
                </footer>
            </div>


            <!-- Screen: Notifications -->
            <div id="screen-notifications" class="screen p-6 flex flex-col h-full bg-gray-50">
                <header class="mb-6 flex items-center">
                    <button onclick="goHome()" class="text-blue-600 p-1 -ml-1"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                    <h1 class="text-xl font-bold text-gray-900 ml-2">Notifications</h1>
                </header>
                <div class="space-y-4">
                    <div class="bg-white p-4 rounded-lg shadow-sm flex space-x-3">
                        <div class="w-10 h-10 bg-green-100 rounded-full flex-shrink-0 flex items-center justify-center"><svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div>
                        <div><h3 class="font-semibold text-gray-900">Transfer Successful</h3><p class="text-sm text-gray-600">Your transfer of 5.00 AED to Vijay Sharma is complete.</p><p class="text-xs text-gray-400 mt-1">10 minutes ago</p></div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm flex space-x-3">
                        <div class="w-10 h-10 bg-blue-100 rounded-full flex-shrink-0 flex items-center justify-center"><svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0c-1.657 0-3-.895-3-2s1.343-2 3-2 3-.895 3-2-1.343-2-3-2m0 8c1.11 0 2.08.402 2.599-1M12 16v-1m0 1v8m0 0c-1.657 0-3-.895-3-2s1.343-2 3-2 3-.895 3-2-1.343-2-3-2m0 8c1.11 0 2.08.402 2.599-1M12 16v-1m0 1v8"></path></svg></div>
                        <div><h3 class="font-semibold text-gray-900">Welcome to Aspora!</h3><p class="text-sm text-gray-600">Your account is verified. Enjoy zero fees on your first transfer.</p><p class="text-xs text-gray-400 mt-1">1 hour ago</p></div>
                    </div>
                </div>
            </div>
        </div> <!-- End Mobile Screen Content -->

        <!-- --- Modals (FIXED: Moved inside frame) --- -->
        <div id="gemini-modal" class="modal" onclick="hideGeminiModal()">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-sm p-6 relative modal-content" onclick="event.stopPropagation()">
                <button onclick="hideGeminiModal()" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center space-x-2"><span class="sparkle">âœ¨</span><span>Generated Message</span></h3>
                <div id="gemini-loading" class="flex flex-col items-center justify-center min-h-[150px]"><div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div><p class="text-gray-600 mt-4">Crafting a message...</p></div>
                <div id="gemini-result" style="display: none;"><p class="text-sm text-gray-600 mb-2">Here's a friendly message you can send:</p><textarea id="gemini-textarea" rows="5" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-700" readonly></textarea><button onclick="copyMessageToClipboard()" id="copy-button" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg mt-4 hover:bg-blue-700 transition-colors">Copy Message</button></div>
                <div id="gemini-error" style="display: none;"><p class="text-center text-red-600 p-4">Sorry, we couldn't generate a message right now. Please try again later.</p></div>
            </div>
        </div>
        <div id="currency-modal" class="modal" onclick="closeCurrencyModal()">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-sm m-4 modal-content" onclick="event.stopPropagation()">
                <header class="p-4 border-b border-gray-200 flex justify-between items-center"><h3 id="currency-modal-title" class="text-lg font-bold text-gray-900">Select Currency</h3><button onclick="closeCurrencyModal()" class="text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></header>
                <div class="p-4 space-y-3 max-h-64 overflow-y-auto">
                    <button onclick="selectCurrency('AED', 'ðŸ‡¦ðŸ‡ª')" class="w-full text-left p-3 hover:bg-gray-100 rounded-lg flex items-center space-x-3"><span class="text-2xl">ðŸ‡¦ðŸ‡ª</span><span class="font-medium">AED - UAE Dirham</span></button>
                    <button onclick="selectCurrency('INR', 'ðŸ‡®ðŸ‡³')" class="w-full text-left p-3 hover:bg-gray-100 rounded-lg flex items-center space-x-3"><span class="text-2xl">ðŸ‡®ðŸ‡³</span><span class="font-medium">INR - Indian Rupee</span></button>
                    <button onclick="selectCurrency('USD', 'ðŸ‡ºðŸ‡¸')" class="w-full text-left p-3 hover:bg-gray-100 rounded-lg flex items-center space-x-3"><span class="text-2xl">ðŸ‡ºðŸ‡¸</span><span class="font-medium">USD - US Dollar</span></button>
                </div>
            </div>
        </div>
        <div id="isd-modal" class="modal" onclick="closeIsdModal()">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-sm m-4 modal-content" onclick="event.stopPropagation()">
                <header class="p-4 border-b border-gray-200 flex justify-between items-center">
                    <h3 class="text-lg font-bold text-gray-900">Select Country Code</h3>
                    <button onclick="closeIsdModal()" class="text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                </header>
                <div class="p-4 space-y-3 max-h-64 overflow-y-auto">
                    <button onclick="selectIsd('AED', 'ðŸ‡¦ðŸ‡ª', '+971')" class="w-full text-left p-3 hover:bg-gray-100 rounded-lg flex items-center space-x-3"><span class="text-2xl">ðŸ‡¦ðŸ‡ª</span><span class="font-medium">UAE (+971)</span></button>
                    <button onclick="selectIsd('INR', 'ðŸ‡®ðŸ‡³', '+91')" class="w-full text-left p-3 hover:bg-gray-100 rounded-lg flex items-center space-x-3"><span class="text-2xl">ðŸ‡®ðŸ‡³</span><span class="font-medium">India (+91)</span></button>
                    <button onclick="selectIsd('USD', 'ðŸ‡ºðŸ‡¸', '+1')" class="w-full text-left p-3 hover:bg-gray-100 rounded-lg flex items-center space-x-3"><span class="text-2xl">ðŸ‡ºðŸ‡¸</span><span class="font-medium">USA (+1)</span></button>
                </div>
            </div>
        </div>
        <div id="permission-modal" class="modal bottom-sheet" onclick="closePermissionModal()">
             <div class="bg-white p-6 pb-8 rounded-t-2xl shadow-xl modal-content" onclick="event.stopPropagation()">
                <div class="flex justify-center mb-4"><div class="w-12 h-1.5 bg-gray-300 rounded-full"></div></div>
                 <h3 id="permission-title" class="text-xl font-bold text-gray-900 mb-3 text-center">Permission Required</h3>
                 <p id="permission-text" class="text-gray-600 text-center mb-6">Please grant permission to continue.</p>
                 <div class="space-y-3">
                     <button id="permission-allow-button" onclick="grantPermission()" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Allow</button>
                     <button onclick="denyPermission()" class="w-full text-gray-600 font-medium py-3 px-5 rounded-lg">Deny</button>
                 </div>
             </div>
        </div>
    </div> <!-- End Mobile Phone Frame -->

    <!-- (RESTORED JAVASCRIPT) -->
    <script>
        let currentScreen = 'screen-welcome'; // Start on welcome
        let rateLockInterval;
        let currencyModalMode = 'from'; // 'from', 'to', or 'request'
        let currentIsd = { code: '+971', flag: 'ðŸ‡¦ðŸ‡ª' };
        let permissionCallback = null; // Store function to call after permission granted
        let requestedPermission = ''; // 'location' or 'camera'
        window.currentTransfer = {};

        // --- Rates ---
        const exchangeRates = {
            'AED-INR': 22.50, 'USD-INR': 83.00, 'AED-USD': 0.27,
            'USD-AED': 3.67, 'INR-AED': 0.044, 'INR-USD': 0.012,
        };

        // --- App State Management ---
        const initialAppState = {
            isLoggedIn: false, kycComplete: false, fundingComplete: false,
            transferComplete: false, isActivated: false, walletBalance: 0.00,
            aedBalance: 0.00, inrBalance: 0.00,
            fromCurrency: { code: 'AED', flag: 'ðŸ‡¦ðŸ‡ª' },
            toCurrency: { code: 'INR', flag: 'ðŸ‡®ðŸ‡³' },
            requestCurrency: { code: 'AED', flag: 'ðŸ‡¦ðŸ‡ª' },
            locationPermissionGranted: false,
            cameraPermissionGranted: false,
            transactions: [ // More dummy data for activated user
                 { sendAmount: '500.00 AED', receiveAmount: '11,250.00 INR', recipient: 'Mom', date: 'Oct 20' },
                 { sendAmount: '1,200.00 AED', receiveAmount: '27,000.00 INR', recipient: 'Dad', date: 'Oct 15' },
                 { sendAmount: '100.00 AED', receiveAmount: '2,250.00 INR', recipient: 'Vijay Sharma', date: 'Oct 10' },
                 { sendAmount: '75.00 AED', receiveAmount: '1,687.50 INR', recipient: 'Friend', date: 'Oct 05' }
            ]
        };
        let appState = { ...initialAppState, transactions: [] }; // Default: new user starts with no transactions

        // --- Helper Function ---
        function formatNumber(num, decimals = 2) {
            return parseFloat(num).toLocaleString('en-US', {
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            });
        }
        
        // --- Rate Lock Timer (Moved Up) ---
        function stopRateLockTimer() { clearInterval(rateLockInterval); }

        function startRateLockTimer() {
            stopRateLockTimer(); // Clear any existing timer
            let seconds = 120; // 2 minutes
            const timerEl = document.getElementById('rate-lock-timer');
            const textEl = document.getElementById('rate-lock-text');
            
            // Ensure elements exist before modifying
            if (!timerEl || !textEl) {
                console.error("Rate lock timer elements not found.");
                return;
            }

            timerEl.innerText = formatTime(seconds);
            textEl.classList.remove('text-red-600');
            textEl.classList.add('text-blue-700');
            textEl.innerText = "Rate Locked for: "; // Reset text
            textEl.appendChild(timerEl); // Re-append timer span


            rateLockInterval = setInterval(() => {
                seconds--;
                timerEl.innerText = formatTime(seconds);
                if (seconds < 30) {
                    textEl.classList.remove('text-blue-700');
                    textEl.classList.add('text-red-600');
                }
                if (seconds <= 0) {
                    stopRateLockTimer();
                    textEl.innerText = "Rate expired. Refreshing...";
                    setTimeout(() => {
                        calculateReceive(); // Recalculate with new (mock) rate
                        startRateLockTimer(); // Restart timer after refresh
                    }, 1500);
                }
            }, 1000);
        }
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }


        // --- Screen Management ---
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => screen.style.display = 'none');
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.style.display = 'flex';
                currentScreen = screenId;
                document.querySelector('.mobile-screen').scrollTop = 0;
            } else {
                console.error(`Screen with ID "${screenId}" not found.`);
                return; // Prevent further errors if screen doesn't exist
            }

            const rateStrip = document.getElementById('rate-strip');
            if (screenId === 'screen-app-home') {
                if (!appState.locationPermissionGranted) {
                    requestPermission('location', () => {
                        console.log("Location permission granted via callback.");
                        appState.locationPermissionGranted = true;
                    });
                }
                updateAppHomeUI();
                if (rateStrip) rateStrip.style.display = 'block';
            } else {
                 if (rateStrip) rateStrip.style.display = 'none';
            }

            if (screenId === 'screen-home-checklist') updateChecklistUI();
            
            // Manage rate lock timer based on screen
            if (screenId === 'screen-transfer') {
                startRateLockTimer();
            } else {
                stopRateLockTimer(); // Stop timer if navigating away from transfer screen
            }

            if (screenId === 'screen-kyc-scan-front' && !appState.cameraPermissionGranted) {
                 requestPermission('camera', () => {
                     console.log("Camera permission granted via callback.");
                     appState.cameraPermissionGranted = true;
                 });
            }
        }

        // --- Login / Logout / Signup ---
        function handleLogin() {
            const mobile = document.getElementById('mobile').value;
            const fullMobile = `${currentIsd.code} ${mobile}`;
            const otpDisplay = document.getElementById('otp-mobile-display');
            if(otpDisplay) otpDisplay.innerText = fullMobile;
            showScreen('screen-otp');
        }

         function handleOtpInput(current, nextId) {
             const otpInputs = Array.from(document.querySelectorAll('#otp-inputs input'));
             const verifyButton = document.getElementById('otp-verify-button');

             // Auto-focus next input
             if (current.value.length === current.maxLength && nextId) {
                 const nextInput = document.getElementById(nextId);
                 if (nextInput) nextInput.focus();
             }

             // Check if all inputs are filled to enable button
             const allFilled = otpInputs.every(input => input.value.length === input.maxLength);
             if (verifyButton) verifyButton.disabled = !allFilled;

             // If last input is filled and valid, try submitting
             if (!nextId && allFilled && current.validity.valid) {
                 handleOtpSubmit();
             }
         }

         function handleOtpBackspace(current, prevId) {
             const verifyButton = document.getElementById('otp-verify-button');
             if (event.key === 'Backspace' && current.value.length === 0 && prevId) {
                  const prevInput = document.getElementById(prevId) || document.querySelector('#otp-inputs input#otp-1'); // Corrected fallback
                  if(prevInput) {
                    prevInput.focus();
                    prevInput.select();
                  }
             }
             // Always check button state on keydown too
             setTimeout(() => { // Use setTimeout to check after potential value change
                 const otpInputs = Array.from(document.querySelectorAll('#otp-inputs input'));
                 const allFilled = otpInputs.every(input => input.value.length === input.maxLength);
                 if (verifyButton) verifyButton.disabled = !allFilled;
             }, 0);
         }


        function handleOtpSubmit() {
            appState.isLoggedIn = true;
            const mobileVal = document.getElementById('mobile').value;
            // Simulate user state based on entered number
            if (currentIsd.code === '+971' && mobileVal === '50 123 4567') {
                 // Simulate existing activated user with history
                 appState = { ...initialAppState, isLoggedIn: true, isActivated: true, walletBalance: 1495.00, aedBalance: 1495.00, inrBalance: 112.50 };
                 // Keep the initial dummy transactions for this user
            } else {
                 // Simulate any other number as a new/unactivated user
                 appState = { ...initialAppState, isLoggedIn: true, transactions: [] };
            }
            goHome();
        }

        function handleNewUserStart() {
            appState = { ...initialAppState, transactions: [] }; // Reset state for new user
            appState.isLoggedIn = true; // Mark as logged in after signup starts
            showScreen('screen-onboarding-1');
        }

        function handleLogout() {
            appState = { ...initialAppState, transactions: [] }; // Reset state completely
            showScreen('screen-login');
        }

        // --- Home Routing ---
        function goHome() {
            if (appState.isActivated) showScreen('screen-app-home');
            else showScreen('screen-home-checklist');
        }

        // --- App Home UI (Error Check Added) ---
        function updateAppHomeUI() {
            const totalBalance = appState.aedBalance + (appState.inrBalance / (exchangeRates['AED-INR'] || 22.5));
            appState.walletBalance = totalBalance;
            
            const walletDisplay = document.getElementById('wallet-balance-display');
            const aedDisplay = document.getElementById('aed-balance-display');
            const inrDisplay = document.getElementById('inr-balance-display');

            if (walletDisplay) walletDisplay.innerText = `${formatNumber(appState.walletBalance)} AED`;
            if (aedDisplay) aedDisplay.innerText = formatNumber(appState.aedBalance);
            if (inrDisplay) inrDisplay.innerText = formatNumber(appState.inrBalance);


            const listEl = document.getElementById('transaction-list');
            const noTxEl = document.getElementById('no-transactions');
            
            if (!listEl || !noTxEl) { // Check if elements exist
                 console.error("Transaction list or 'no transactions' element not found in updateAppHomeUI.");
                 return;
            }
            
            listEl.innerHTML = ''; // Clear previous entries
            if (appState.transactions.length > 0) {
                noTxEl.style.display = 'none'; // Hide the 'no transactions' message
                appState.transactions.slice(0, 4).forEach(tx => { // Display up to 4
                    const txEl = document.createElement('div');
                    txEl.className = 'bg-white p-4 rounded-lg shadow-md flex items-center justify-between';
                    txEl.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center">
                                <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>
                            </div>
                            <div> <p class="font-semibold text-gray-900">${tx.recipient}</p> <p class="text-sm text-gray-500">${tx.date}</p> </div>
                        </div>
                        <span class="font-semibold text-red-600">-${tx.sendAmount}</span>`;
                    listEl.appendChild(txEl);
                });
            } else {
                noTxEl.style.display = 'block'; // Show the 'no transactions' message
            }
        }

        // --- KYC Simulation ---
        function simulateKycScan(step) {
            let feedbackElId;
            let nextScreen;
            if (step === 'front') {
                feedbackElId = 'kyc-front-feedback';
                nextScreen = 'screen-kyc-scan-back';
            } else if (step === 'back') {
                feedbackElId = 'kyc-back-feedback';
                nextScreen = 'screen-kyc-selfie';
            } else { // selfie
                feedbackElId = 'kyc-selfie-feedback';
                nextScreen = 'screen-kyc-verifying';
            }
            
            const feedbackEl = document.getElementById(feedbackElId);
            if (!feedbackEl) return; // Exit if element not found

            feedbackEl.innerText = 'Scanning... Hold steady.';
            setTimeout(() => {
                feedbackEl.innerText = 'Scan complete!';
                setTimeout(() => {
                    showScreen(nextScreen);
                    if (nextScreen === 'screen-kyc-verifying') {
                        // Simulate verification time
                        setTimeout(() => showScreen('screen-kyc-verified'), 2500);
                    }
                }, 1000);
            }, 1500);
        }

        // --- Checklist Logic ---
        function completeKycStep() { appState.kycComplete = true; goHome(); }
        function completeFundingStep() {
             appState.fundingComplete = true;
             if (appState.aedBalance === 0) appState.aedBalance = 1500.00; // Add initial funds
             goHome();
        }
        function completeTransferStep() { appState.transferComplete = true; appState.isActivated = true; }
        
        function updateChecklistUI() {
            // KYC Step Elements
            const kycItem = document.getElementById('checklist-kyc');
            const kycIcon = document.getElementById('checklist-kyc-icon');
            const kycTitle = document.getElementById('checklist-kyc-title');
            const kycSubtitle = document.getElementById('checklist-kyc-subtitle');
            const kycButton = document.getElementById('checklist-kyc-button');

            // Funding Step Elements
            const fundingItem = document.getElementById('checklist-funding');
            const fundingIcon = document.getElementById('checklist-funding-icon');
            const fundingTitle = document.getElementById('checklist-funding-title');
            const fundingSubtitle = document.getElementById('checklist-funding-subtitle');
            const fundingButton = document.getElementById('checklist-funding-button');

            // Transfer Step Elements
            const transferItem = document.getElementById('checklist-transfer');
            const transferIcon = document.getElementById('checklist-transfer-icon');
            const transferTitle = document.getElementById('checklist-transfer-title');
            const transferButton = document.getElementById('checklist-transfer-button');

            // --- Update KYC State ---
            if (appState.kycComplete) {
                if(kycItem) kycItem.classList.add('opacity-100'); // Ensure visible
                if(kycIcon) {
                    kycIcon.classList.remove('bg-blue-100', 'text-blue-600');
                    kycIcon.classList.add('bg-green-100', 'text-green-600');
                    kycIcon.innerHTML = `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>`;
                }
                if(kycTitle) kycTitle.innerText = "Identity verified";
                if(kycSubtitle) kycSubtitle.innerText = "Complete";
                if(kycButton) kycButton.style.display = 'none';
            } else {
                 // Reset if needed (though unlikely in this flow)
                 if(kycItem) kycItem.classList.remove('opacity-100');
                 if(kycIcon) {
                     kycIcon.classList.remove('bg-green-100', 'text-green-600');
                     kycIcon.classList.add('bg-blue-100', 'text-blue-600');
                     kycIcon.innerHTML = '1';
                 }
                if(kycTitle) kycTitle.innerText = "Verify your identity";
                if(kycSubtitle) kycSubtitle.innerText = "Required by UAE law";
                if(kycButton) kycButton.style.display = 'block';
            }

            // --- Update Funding State ---
             if (fundingItem && fundingIcon && fundingTitle && fundingButton) {
                 if (appState.kycComplete) {
                    fundingItem.classList.remove('opacity-50');
                    fundingIcon.classList.remove('bg-gray-100', 'text-gray-500');
                    fundingIcon.classList.add('bg-blue-100', 'text-blue-600');
                    fundingTitle.classList.remove('text-gray-700');
                    fundingTitle.classList.add('text-gray-900');
                    fundingButton.disabled = false;
                    fundingButton.classList.remove('bg-gray-200', 'text-gray-500');
                    fundingButton.classList.add('bg-blue-600', 'text-white');
                    fundingButton.onclick = () => showScreen('screen-funding-picker');
                    fundingButton.style.display = 'block'; // Ensure button is visible initially
                } else {
                     fundingItem.classList.add('opacity-50'); // Keep disabled if KYC not done
                     fundingIcon.classList.remove('bg-blue-100', 'text-blue-600', 'bg-green-100', 'text-green-600');
                     fundingIcon.classList.add('bg-gray-100', 'text-gray-500');
                     fundingIcon.innerHTML = '2';
                     fundingTitle.classList.remove('text-gray-900');
                     fundingTitle.classList.add('text-gray-700');
                     fundingButton.disabled = true;
                     fundingButton.classList.remove('bg-blue-600', 'text-white');
                     fundingButton.classList.add('bg-gray-200', 'text-gray-500');
                     fundingButton.onclick = null;
                     fundingButton.style.display = 'block';
                }

                if (appState.fundingComplete) {
                    fundingIcon.classList.remove('bg-blue-100', 'text-blue-600');
                    fundingIcon.classList.add('bg-green-100', 'text-green-600');
                    fundingIcon.innerHTML = `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>`;
                    fundingTitle.innerText = "Account funded";
                    if(fundingSubtitle) fundingSubtitle.innerText = "Complete";
                    fundingButton.style.display = 'none';
                }
             }

            // --- Update Transfer State ---
            if (transferItem && transferIcon && transferTitle && transferButton) {
                if (appState.kycComplete && appState.fundingComplete) {
                    transferItem.classList.remove('opacity-50');
                    transferIcon.classList.remove('bg-gray-100', 'text-gray-500');
                    transferIcon.classList.add('bg-blue-100', 'text-blue-600');
                    transferTitle.classList.remove('text-gray-700');
                    transferTitle.classList.add('text-gray-900');
                    transferButton.disabled = false;
                    transferButton.classList.remove('bg-gray-200', 'text-gray-500');
                    transferButton.classList.add('bg-blue-600', 'text-white');
                    transferButton.onclick = () => loadTransferScreen();
                     transferButton.style.display = 'block'; // Ensure button is visible initially
                } else {
                     transferItem.classList.add('opacity-50');
                     transferIcon.classList.remove('bg-blue-100', 'text-blue-600');
                     transferIcon.classList.add('bg-gray-100', 'text-gray-500');
                     transferIcon.innerHTML = '3';
                     transferTitle.classList.remove('text-gray-900');
                     transferTitle.classList.add('text-gray-700');
                     transferButton.disabled = true;
                     transferButton.classList.remove('bg-blue-600', 'text-white');
                     transferButton.classList.add('bg-gray-200', 'text-gray-500');
                     transferButton.onclick = null;
                     transferButton.style.display = 'block';
                }
                // Note: Transfer complete state is handled by navigating away from checklist
            }
        }
        
        // --- Transfer Screen Logic ---
        function loadTransferScreen() {
             showScreen('screen-transfer'); // Show screen first
             const sendAmountEl = document.getElementById('send-amount');
             const starterBanner = document.getElementById('transfer-starter-banner');
             const title = document.getElementById('transfer-title');
             const feeDisplay = document.getElementById('fee-display');

             if (!sendAmountEl || !starterBanner || !title || !feeDisplay) {
                 console.error("One or more transfer screen elements not found.");
                 return;
             }

             if (appState.isActivated) {
                 title.innerText = "Send Money";
                 sendAmountEl.value = ""; sendAmountEl.placeholder = "0.00";
                 starterBanner.style.display = 'none';
                 feeDisplay.innerText = `2.50 ${appState.fromCurrency.code}`;
                 feeDisplay.classList.remove('text-green-600');
                 feeDisplay.classList.add('text-gray-900');
             } else {
                 title.innerText = "Your Starter Transfer";
                 sendAmountEl.value = "5";
                 starterBanner.style.display = 'flex';
                 feeDisplay.innerText = "FREE (Gift)";
                 feeDisplay.classList.remove('text-gray-900');
                 feeDisplay.classList.add('text-green-600');
             }
             sendAmountEl.readOnly = false;
             sendAmountEl.classList.remove('bg-gray-100');
             updateCurrencyUI();
             calculateReceive();
             startRateLockTimer(); // Start timer after loading screen
        }


        // --- Currency Modal Logic ---
        function openCurrencyModal(mode) {
            currencyModalMode = mode;
            let title = 'Select Currency';
            if (mode === 'from') title = 'Select sending currency';
            else if (mode === 'to') title = 'Select receiving currency';
            else if (mode === 'request') title = 'Select request currency';

            const modalTitleEl = document.getElementById('currency-modal-title');
            if(modalTitleEl) modalTitleEl.innerText = title;
            document.getElementById('currency-modal').style.display = 'flex';
        }
        function closeCurrencyModal() { document.getElementById('currency-modal').style.display = 'none'; }
        function selectCurrency(code, flag) {
            if (currencyModalMode === 'from') {
                if (code === appState.toCurrency.code) appState.toCurrency = { ...appState.fromCurrency };
                appState.fromCurrency = { code, flag };
            } else if (currencyModalMode === 'to') {
                if (code === appState.fromCurrency.code) appState.fromCurrency = { ...appState.toCurrency };
                appState.toCurrency = { code, flag };
            } else if (currencyModalMode === 'request') {
                 appState.requestCurrency = { code, flag };
                 const reqFlag = document.getElementById('request-currency-flag');
                 const reqCode = document.getElementById('request-currency-code');
                 if(reqFlag) reqFlag.innerText = flag;
                 if(reqCode) reqCode.innerText = code;
            }

            if (currencyModalMode === 'from' || currencyModalMode === 'to') {
                updateCurrencyUI();
                calculateReceive();
                const feeDisplay = document.getElementById('fee-display');
                 if(feeDisplay){
                     if (appState.isActivated) {
                          feeDisplay.innerText = `2.50 ${appState.fromCurrency.code}`;
                          feeDisplay.classList.remove('text-green-600');
                          feeDisplay.classList.add('text-gray-900');
                     } else {
                          feeDisplay.innerText = "FREE (Gift)";
                          feeDisplay.classList.remove('text-gray-900');
                          feeDisplay.classList.add('text-green-600');
                     }
                 }
            }
            closeCurrencyModal();
        }
        function updateCurrencyUI() {
             const fromFlag = document.getElementById('from-currency-flag');
             const fromCode = document.getElementById('from-currency-code');
             const toFlag = document.getElementById('to-currency-flag');
             const toCode = document.getElementById('to-currency-code');
             if(fromFlag) fromFlag.innerText = appState.fromCurrency.flag;
             if(fromCode) fromCode.innerText = appState.fromCurrency.code;
             if(toFlag) toFlag.innerText = appState.toCurrency.flag;
             if(toCode) toCode.innerText = appState.toCurrency.code;
        }

        // --- Transfer Calculations & Confirmation ---
        function getExchangeRate(from = appState.fromCurrency.code, to = appState.toCurrency.code) {
            const key = `${from}-${to}`;
            const reverseKey = `${to}-${from}`;
            
            if (exchangeRates[key]) return exchangeRates[key];
            if (exchangeRates[reverseKey]) return 1 / exchangeRates[reverseKey];
            console.warn(`Exchange rate not found for ${from}-${to}`);
            return 1; // Default if no rate found
        }
        
        function calculateReceive() {
            const sendAmountEl = document.getElementById('send-amount');
            const receiveAmountEl = document.getElementById('receive-amount');
            const rateDisplayEl = document.getElementById('exchange-rate-display');

            if (!sendAmountEl || !receiveAmountEl || !rateDisplayEl) return;

            const sendAmount = parseFloat(sendAmountEl.value) || 0;
            const rate = getExchangeRate();
            const receiveAmount = sendAmount * rate;
            
            receiveAmountEl.value = formatNumber(receiveAmount);
            rateDisplayEl.innerText = `1 ${appState.fromCurrency.code} = ${formatNumber(rate, 4)} ${appState.toCurrency.code}`;
            
            window.currentTransfer = {
                sendAmount: sendAmount,
                receiveAmount: receiveAmount,
                rate: rate,
                fee: appState.isActivated ? 2.50 : 0
            };
        }

        function showConfirmation() {
            calculateReceive(); // Recalculate just in case
            const { sendAmount, receiveAmount, rate, fee } = window.currentTransfer;
            const fromCode = appState.fromCurrency.code;
            const toCode = appState.toCurrency.code;
            
            // Populate confirmation screen elements, checking if they exist
            const confirmSend = document.getElementById('confirm-send-amount');
            const confirmRecipient = document.getElementById('confirm-recipient-name');
            const confirmReceive = document.getElementById('confirm-receive-amount');
            const confirmRate = document.getElementById('confirm-exchange-rate');
            const confirmFee = document.getElementById('confirm-fee');
            const confirmTotal = document.getElementById('confirm-total');

            if(confirmSend) confirmSend.innerText = `${formatNumber(sendAmount)} ${fromCode}`;
            if(confirmRecipient) confirmRecipient.innerText = "Vijay Sharma"; // Hardcoded
            if(confirmReceive) confirmReceive.innerText = `${formatNumber(receiveAmount)} ${toCode}`;
            if(confirmRate) confirmRate.innerText = `1 ${fromCode} = ${formatNumber(rate, 4)} ${toCode}`;
            
            const total = sendAmount + fee;
            if(confirmTotal) confirmTotal.innerText = `${formatNumber(total)} ${fromCode}`;
            
            if (confirmFee) {
                if (fee === 0) {
                    confirmFee.innerText = "FREE";
                    confirmFee.classList.add('text-green-600');
                    confirmFee.classList.remove('text-gray-900');
                } else {
                    confirmFee.innerText = `${formatNumber(fee)} ${fromCode}`;
                    confirmFee.classList.remove('text-green-600');
                    confirmFee.classList.add('text-gray-900');
                }
            }
            
            showScreen('screen-confirmation');
        }

        function handleSuccess() {
            completeTransferStep(); // Mark activation complete
            const { sendAmount, receiveAmount, fee } = window.currentTransfer;
            const fromCode = appState.fromCurrency.code;
            const toCode = appState.toCurrency.code;
            
            const successMsgEl = document.getElementById('success-message');
            if(successMsgEl) successMsgEl.innerHTML = `Your <span class="font-semibold">${formatNumber(sendAmount)} ${fromCode}</span> is on its way to Vijay Sharma.`;
            
            // Update wallet balances
            appState.aedBalance -= (sendAmount + fee);
            appState.inrBalance += receiveAmount; // Simulating holding INR balance
            
            // Add transaction to the beginning of the list
            appState.transactions.unshift({
                sendAmount: `${formatNumber(sendAmount)} ${fromCode}`,
                receiveAmount: `${formatNumber(receiveAmount)} ${toCode}`,
                recipient: 'Vijay Sharma', // Hardcoded recipient
                date: 'Just now'
            });
            
            showScreen('screen-success');
        }

        // --- ISD Code Modal Logic ---
        function openIsdModal() { document.getElementById('isd-modal').style.display = 'flex'; }
        function closeIsdModal() { document.getElementById('isd-modal').style.display = 'none'; }
        function selectIsd(countryCode, flag, code) {
            currentIsd = { code, flag };
            const isdFlagEl = document.getElementById('isd-flag');
            const isdCodeEl = document.getElementById('isd-code');
            if(isdFlagEl) isdFlagEl.innerText = flag;
            if(isdCodeEl) isdCodeEl.innerText = code;
            const mobile = document.getElementById('mobile').value;
            const otpDisplay = document.getElementById('otp-mobile-display');
            if(otpDisplay) otpDisplay.innerText = `${code} ${mobile}`;
            closeIsdModal();
        }

         // --- Permission Modal Logic ---
        function requestPermission(type, callback) {
            requestedPermission = type;
            permissionCallback = callback;
            const modal = document.getElementById('permission-modal');
            const titleEl = document.getElementById('permission-title');
            const textEl = document.getElementById('permission-text');
            const allowBtn = document.getElementById('permission-allow-button');

            if (!modal || !titleEl || !textEl || !allowBtn) return; // Exit if elements missing

            if (type === 'location') {
                titleEl.innerText = "Allow Location Access";
                textEl.innerText = "Aspora needs access to your location to comply with regulations and offer relevant services.";
                allowBtn.innerText = "Allow Location";
            } else if (type === 'camera') {
                 titleEl.innerText = "Allow Camera Access";
                 textEl.innerText = "Aspora needs access to your camera to scan your ID documents for verification.";
                 allowBtn.innerText = "Allow Camera";
            }
            modal.style.display = 'flex';
        }

        function closePermissionModal() {
            const modal = document.getElementById('permission-modal');
            if (modal) modal.style.display = 'none';
            permissionCallback = null;
            requestedPermission = '';
        }

        function grantPermission() {
            console.log(`Permission granted for: ${requestedPermission}`);
            if (permissionCallback) {
                permissionCallback();
            }
            if (requestedPermission === 'location') appState.locationPermissionGranted = true;
            if (requestedPermission === 'camera') appState.cameraPermissionGranted = true;
            closePermissionModal();
        }

        function denyPermission() {
            console.log(`Permission denied for: ${requestedPermission}`);
            closePermissionModal();
        }


        // --- Initialize ---
        document.addEventListener('DOMContentLoaded', () => {
             // TESTING: Uncomment to start as an activated user
             // appState = { ...initialAppState, isLoggedIn: true, isActivated: true, walletBalance: 1495.00, aedBalance: 1495.00, inrBalance: 112.50 };
             // goHome();
             // return;

             showScreen('screen-welcome');
        });

        // --- Gemini API ---
        function showGeminiModal() {
            const modal = document.getElementById('gemini-modal');
            if (!modal) return;
            modal.style.display = 'flex';
            const loading = document.getElementById('gemini-loading');
            const result = document.getElementById('gemini-result');
            const error = document.getElementById('gemini-error');

            if(loading) loading.style.display = 'flex';
            if(result) result.style.display = 'none';
            if(error) error.style.display = 'none';

            const { sendAmount } = window.currentTransfer || { sendAmount: 0 }; // Default if no transfer yet
            const fromCode = appState.fromCurrency.code;
            
            const systemPrompt = "You are a friendly assistant for a remittance app called Aspora. A user has just sent money to a recipient. Generate a short, friendly, one-paragraph notification message (in English or Hinglish) that the sender can copy and send to the recipient. The message must mention the amount and currency *sent*.";
            const userQuery = `I just sent ${formatNumber(sendAmount)} ${fromCode}. Please generate a short notification message for my recipient, Vijay, in a friendly tone.`;
            
            handleGeminiNotify(systemPrompt, userQuery);
        }

        function hideGeminiModal() {
            const modal = document.getElementById('gemini-modal');
            if (modal) modal.style.display = 'none';
        }

        async function handleGeminiNotify(systemPrompt, userQuery) {
            const loading = document.getElementById('gemini-loading');
            const resultDiv = document.getElementById('gemini-result');
            const errorDiv = document.getElementById('gemini-error');
            const textarea = document.getElementById('gemini-textarea');
            const copyButton = document.getElementById('copy-button');

            try {
                const response = await callGeminiApi(systemPrompt, userQuery);
                const text = response.text;
                
                if(loading) loading.style.display = 'none';
                if(resultDiv) resultDiv.style.display = 'block';
                if(textarea) textarea.value = text;
                if(copyButton) copyButton.innerText = "Copy Message";
                
            } catch (error) {
                console.error('Gemini API call failed:', error);
                 if(loading) loading.style.display = 'none';
                 if(errorDiv) errorDiv.style.display = 'block';
            }
        }

        async function callGeminiApi(systemPrompt, userQuery, retries = 3, delay = 1000) {
            const apiKey = ""; // Leave as-is
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 || response.status >= 500) {
                            throw new Error(`API Error: ${response.status}`);
                        } else {
                            const errorResult = await response.json();
                            throw new Error(errorResult.error?.message || 'API request failed');
                        }
                    }

                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (text) {
                        return { text };
                    } else {
                        throw new Error('Invalid response structure from API');
                    }
                } catch (error) {
                    console.error(`Attempt ${i + 1} failed:`, error.message);
                    if (i === retries - 1 || (error.message && !error.message.startsWith('API Error:'))) { // Don't retry client errors
                        throw error;
                    }
                    await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
                }
            }
             throw new Error('API request failed after multiple retries.'); // Should not be reached if retries > 0
        }

        function copyMessageToClipboard() {
            const textarea = document.getElementById('gemini-textarea');
            const copyButton = document.getElementById('copy-button');
            if(!textarea || !copyButton) return;

            textarea.select();
            textarea.setSelectionRange(0, 99999);
            try {
                document.execCommand('copy');
                copyButton.innerText = "Copied!";
            } catch (err) {
                console.error('Failed to copy text: ', err);
                alert('Failed to copy. Please copy manually.');
            }
        }
    </script>

</body>
</html>

